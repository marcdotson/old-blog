---
title: "Non-centered parameterization for hierarchical models"
author: "Marc Dotson"
date: '2020-03-01'
slug: non-centered
---



<p>In a <a href="https://www.occasionaldivergences.com/post/stan-hierarchical/">previous post</a>, we provided a gentle introduction to building hierarchical models in Stan. We quickly ran into divergences (i.e., divergent transitions) when attempting to estimate our model. While hierarchical models have posteriors with <a href="https://arxiv.org/abs/1312.0906">geometry that is difficult to navigate</a>, which is true independent of sampler, we were able to initially fix the problem by more carefully navigating the posterior with a smaller step size.</p>
<p>However, the posterior geometry of hierarchical models typically requires a non-centered parameterization, expressing the same model in a different way to ease the navigation of the posterior. The goal of this post is to expand on that <a href="https://www.occasionaldivergences.com/post/stan-hierarchical/">previous post</a> by providing a walkthrough for non-centered parameterizations for hierarchical Bayesian models in Stan.</p>
<div id="non-centered-parameterization" class="section level2">
<h2>Non-centered parameterization</h2>
<p>Our assumed error is <code>delta ~ normal(0, 1)</code> such that <code>beta = mu + tau * delta</code>. Following a centered parameterization, we can translate this into a population model and likelihood for a simple hierarchical regression as:</p>
<pre><code>beta ~ normal(mu, tau);
y ~ normal(beta, sigma);</code></pre>
<p>where we get draws from the posterior distribution of <code>mu</code>, <code>tau</code>, and <code>beta</code>.</p>
<p>On the other hand, following a non-centered parameterization, we can translate this into a population model and likelihood for a simple hierarchical regression as:</p>
<pre><code>delta ~ normal(0, 1);
beta = mu + tau * delta;
y ~ normal(beta, sigma);</code></pre>
<p>where we now get draws from the posterior distribution of <code>mu</code>, <code>tau</code>, and <code>delta</code>, since <code>beta</code> is now a fixed transformation rather than its own draw. The non-centered parameterization is thus simply that, including <code>delta</code> rather than <code>beta</code> in the posterior distribution, where <code>beta</code> is often the vector of parameters that introduces difficult geometry.</p>
</div>
<div id="simple-hierarchical-regression" class="section level2">
<h2>Simple hierarchical regression</h2>
</div>
<div id="multiple-hierarchical-regression" class="section level2">
<h2>Multiple hierarchical regression</h2>
<hr />
<div id="marc-dotson" class="section level3">
<h3>Marc Dotson</h3>
<p>Marc is an assistant professor of marketing at the BYU Marriott School of Business. He graduated with an MSc from The London School of Economics and Political Science in 2009 and a PhD from The Ohio State University in 2016. His research interests include Bayesian inference, predictive modeling, consumer preference heterogeneity, and unstructured data. Marc teaches marketing analytics. You can find him on <a href="https://twitter.com/marcdotson">Twitter</a> and <a href="https://github.com/marcdotson">GitHub</a>.</p>
</div>
</div>
